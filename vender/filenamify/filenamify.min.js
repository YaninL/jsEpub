function escapeStringRegexp(e){if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function trimRepeated(e,r){if("string"!=typeof e||"string"!=typeof r)throw new TypeError("Expected a string");var t=new RegExp("(?:"+escapeStringRegexp(r)+"){2,}","g");return e.replace(t,r)}function filenameReservedRegex(){return/[<>:"/\\|?*\u0000-\u001F]/g}function windowsReservedNameRegex(){return/^(con|prn|aux|nul|com\d|lpt\d)$/i}function stripOuter(e,r){if("string"!=typeof e||"string"!=typeof r)throw new TypeError("Expected a string");return e.startsWith(r)&&(e=e.slice(r.length)),e.endsWith(r)&&(e=e.slice(0,-r.length)),e}const MAX_FILENAME_LENGTH=100,reControlChars=/[\u0000-\u001F\u0080-\u009F]/g,reRelativePath=/^\.+/,reTrailingPeriods=/\.+$/;function filenamify(e,r={}){if("string"!=typeof e)throw new TypeError("Expected a string");var t=void 0===r.replacement?"!":r.replacement;if(filenameReservedRegex().test(t)&&reControlChars.test(t))throw new Error("Replacement string cannot contain reserved filename characters");e=(e=(e=(e=(e=e.normalize("NFD")).replace(filenameReservedRegex(),t)).replace(reControlChars,t)).replace(reRelativePath,t)).replace(reTrailingPeriods,""),0<t.length&&(e=1<(e=trimRepeated(e,t)).length?stripOuter(e,t):e),e=windowsReservedNameRegex().test(e)?e+t:e;t="number"==typeof r.maxLength?r.maxLength:MAX_FILENAME_LENGTH;return e.length>t&&(r=e.lastIndexOf("."),e=e.slice(0,Math.min(t,r))+e.slice(r)),e}